# Function API Calling

CLIโััะตะนะผะฒะพัะบ ะดะปั ัะตััะธัะพะฒะฐะฝะธั ััะฝะบัะธะน ะธ ััะตะผ ัะตัะตะท **OpenRouter API**.  
ะะพะทะฒะพะปัะตั ะทะฐะฟััะบะฐัั ัะตััะพะฒัะต ััะตะฝะฐัะธะธ ะธะท YAML, ะฟัะพะฒะตัััั ะบะพััะตะบัะฝะพััั ะฒัะทะพะฒะพะฒ ะธ ัะพัะผะธัะพะฒะฐัั ะพััััั ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ ะธ CI.

---

## ๐ ะะพะทะผะพะถะฝะพััะธ
- ะะตะณะธัััะฐัะธั ััะฝะบัะธะน ะธะท `.py` ัะฐะนะปะพะฒ ะธ ััะตะผ ะธะท `.json`.
- ะัะพะฒะตัะบะฐ ัะธะณะฝะฐัััั ะธ ััะตะผั (`Validator`).
- ะะฐะฟััะบ ัะตััะพะฒ ะธะท YAML suite (`--tests`).
- ะะพะดะดะตัะถะบะฐ ัะตะฟะพัะตะบ ะฒัะทะพะฒะพะฒ (`tool_calls` ะธ `function_call`).
- ะะฒัะพะผะฐัะธัะตัะบะฐั ะณะตะฝะตัะฐัะธั ะพััััะพะฒ:
  - ะปะพะบะฐะปัะฝะพ (ัะธัะฐะตะผัะน ะฒัะฒะพะด ะฒ ะบะพะฝัะพะปั),
  - ะฒ CI (JSONโะพัััั ะดะปั GitHub Actions).

---

## ๐๏ธ ะกัะตะบ
- Python 3.12+
- OpenRouter API / OpenAI SDK
- YAML ะดะปั ะพะฟะธัะฐะฝะธั ัะตััะพะฒ
- rich โ ัะพัะผะฐัะธัะพะฒะฐะฝะฝัะน ะฒัะฒะพะด
- black, ruff โ ะฐะฒัะพัะพัะผะฐั ะธ ะปะธะฝัะธะฝะณ

---

## โถ๏ธ ะะฐะฟััะบ ัะตััะพะฒ (ะะฐะณะปััะบะฐ)

```bash
python test_runner.py --function functions/weather.py --schema functions/weather.json --tests suites/weather.yaml
๐ฅ ะะฐัะตะณะธัััะธัะพะฒะฐะฝะฐ ััะฝะบัะธั: weather

๐ ะขะตัั 1/3: 'ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะะธะฝัะบะต?'
โก๏ธ ะัะทะพะฒ 1: weather({'city': 'Minsk'})
โ๏ธ ะะตะทัะปััะฐั weather: {"temperature": 0, "condition": "unknown"}

๐ ะขะตัั 2/3: 'ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะัะตััะต?'
โก๏ธ ะัะทะพะฒ 1: weather({'city': 'Brest'})
โ๏ธ ะะตะทัะปััะฐั weather: {"temperature": 0, "condition": "unknown"}

๐ ะขะตัั 3/3: 'ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะัะพะดะฝะพ?'
โก๏ธ ะัะทะพะฒ 1: weather({'city': 'ะัะพะดะฝะพ'})
โ๏ธ ะะตะทัะปััะฐั weather: {"temperature": 0, "condition": "unknown"}
                                   ะะตะทัะปััะฐัั ัะตััะพะฒ
โโโโโโโโณโโโโโโโโโโณโโโโโโโโโโโโโโโโโโโโโโโโโณโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะขะตัั โ ะคัะฝะบัะธั โ ะะฐะฟัะพั                 โ ะะตะทัะปััะฐั                                  โ
โกโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฉ
โ    1 โ weather โ ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะะธะฝัะบะต? โ {"temperature": 0, "condition": "unknown"} โ
โ    2 โ weather โ ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะัะตััะต? โ {"temperature": 0, "condition": "unknown"} โ
โ    3 โ weather โ ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะัะพะดะฝะพ? โ {"temperature": 0, "condition": "unknown"} โ
โโโโโโโโดโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะัะธะผะตั ัะพัะผะธัะพะฒะฐะฝะธั suite.yaml
```yaml
- query: "ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะะธะฝัะบะต?"
  description: "ะัะพะฒะตัะบะฐ ััะฝะบัะธะธ weather ะดะปั ะณะพัะพะดะฐ ะะธะฝัะบ"

- query: "ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะัะตััะต?"
  description: "ะัะพะฒะตัะบะฐ ััะฝะบัะธะธ weather ะดะปั ะณะพัะพะดะฐ ะัะตัั"

- query: "ะะฐะบะฐั ะฟะพะณะพะดะฐ ะฒ ะัะพะดะฝะพ?"
  description: "ะัะพะฒะตัะบะฐ ััะฝะบัะธะธ weather ะดะปั ะณะพัะพะดะฐ ะฑะตะท ะดะฐะฝะฝัั"

- query: ะะพััะฐะฒั ะดะฐัั 2025-12-31 ะฒ "ะะบะพะฝัะฐะฝะธะต" ะณะดะต "ะะฐะทะฒะฐะฝะธะต" = "ะัะตะดะธั ะะตัะฝะฐ" ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั you_uri_database ะธัะฟะพะปัะทัั ัะพะบะตะฝ <#secret.NOTION_TOKEN>
```
****ะัะต ะบะปััะธ ะทะฐะฟะธััะฒะฐััั ะฒ ะฒะธะดะต <#secret.YOUR_KEY>***


### ะัะธะผะตั ัะพัะผะธัะพะฒะฐะฝะธั function.py
```python
def weather(arguments: dict) -> str: ...
```

### ะัะธะผะตั ัะพัะผะธัะพะฒะฐะฝะธั schema.json
```json
{
  "name": "weather",
  "description": "ะะพะปััะฐะตั ัะตะบัััั ะฟะพะณะพะดั ะดะปั ัะบะฐะทะฐะฝะฝะพะณะพ ะณะพัะพะดะฐ",
  "parameters": {
    "type": "object",
    "properties": {
      "city": {
        "type": "string",
        "description": "ะะฐะทะฒะฐะฝะธะต ะณะพัะพะดะฐ"
      }
    },
    "required": ["city"]
  }
}
```

## ๐ CI/CD (Docker + GitHub Actions)
ะัะพะตะบั ะฟะพะดะดะตัะถะธะฒะฐะตั ะทะฐะฟััะบ ัะตััะพะฒ ะฒ CI ัะตัะตะท Dockerโะบะพะฝัะตะนะฝะตั.

ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั
ะะตะฟะพะทะธัะพัะธะน ะ โ ัะพะดะตัะถะธั ััะฝะบัะธั ะธ ะตั ััะตะผั (.py + .json + .yaml).

ะะตะฟะพะทะธัะพัะธะน B โ ัะพะดะตัะถะธั Dockerfile ะธ ัะตััะพะฒัะน ััะตะนะผะฒะพัะบ (ััะพั ะฟัะพะตะบั).

Workflow:

ะกะพะฑะธัะฐะตั Dockerโะพะฑัะฐะท ะธะท ัะตะฟะพะทะธัะพัะธั B.

ะะพะฝัะธััะตั ะบะพะด ะธะท ัะตะฟะพะทะธัะพัะธั ะ ะฒะฝัััั ะบะพะฝัะตะนะฝะตัะฐ.

ะะฐะฟััะบะฐะตั ัะตััะพะฒัะน ััะตะนะผะฒะพัะบ ั ัะบะฐะทะฐะฝะฝัะผะธ ะฐัะณัะผะตะฝัะฐะผะธ (--function, --schema, --tests).

ะัะพะณะพะฝัะตั ัะตััั, ัะพัะผะธััะตั ะพัััั (LocalReporter ะดะปั ะปะพะบะฐะปัะฝะพะณะพ ะทะฐะฟััะบะฐ ะธะปะธ CIReporter ะดะปั GitHub Actions).

ะะตะทัะปััะฐัั ัะพััะฐะฝััััั ะฒ ะฐััะตัะฐะบัั CI/CD (test_results.json) ะธะปะธ ะฒัะฒะพะดัััั ะฒ ะบะพะฝัะพะปั.

Workflow ะดะปั ัะตะฟะพะทะธัะพัะธั ะ
ะ ัะตะฟะพะทะธัะพัะธะธ ั ััะฝะบัะธะตะน ะฝัะถะฝะพ ัะพะทะดะฐัั ัะฐะนะป .github/workflows/run-tests.yml:
```yml
name: Run Function Tests


on:
  workflow_dispatch:

jobs:
  call-tests:
    uses: Smaipl/Tests-Function-Api-Calling-OpenAi/.github/workflows/test_functions_on_model.yml@main
    with:
      function_name: "name function"
    secrets:
      OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
      ADDITIONAL_SECRETS: ${{ secrets.ADDITIONAL_SECRETS }} # ัะตะบัะตั ะทะฐะฟะธััะฒะฐะตััั ะฒ ัะพัะผะฐัะต json
      # 
      #   {
      #      "NAME_SECRET": "VALUE_SECRET",
      #      "NAME_SECRET_TWO": "VALUE_SECRET_TWO"
      #   }
      # 
```
